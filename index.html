<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RNG Build Optimizer</title>
    <style>
        :root {
            --bg-color: #0f0f0f;
            --panel-bg: #1a1a1a;
            --accent: #00e5ff;
            --text-main: #ffffff;
            --text-dim: #b0b0b0;
            --border: #333;
            --exotic: #ff0011;
            --mythic: #cf0064;
            --legendary: #e66300;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }

        .container {
            display: grid;
            grid-template-columns: 320px 1fr 320px;
            gap: 15px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .panel {
            background: var(--panel-bg);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        h2 { color: var(--accent); margin-top: 0; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; }
        h3 { font-size: 0.9rem; margin: 15px 0 10px; border-bottom: 1px solid #444; padding-bottom: 5px; }

        .input-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 4px; }
        select, input {
            width: 100%;
            padding: 8px;
            background: #252525;
            border: 1px solid #444;
            color: #fff;
            border-radius: 6px;
        }

        .ore-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 8px;
            margin-bottom: 20px;
        }

        .ore-toggle {
            display: flex;
            align-items: center;
            font-size: 0.75rem;
            background: #222;
            padding: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.2s;
        }

        .ore-toggle:hover { background: #333; }
        .ore-toggle input { width: auto; margin-right: 8px; }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #2a2a2a;
            font-size: 0.9rem;
        }

        .big-result {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(145deg, #222, #111);
            border: 2px solid var(--accent);
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 0 20px rgba(0, 229, 255, 0.2);
        }

        .big-result h1 { margin: 0; font-size: 2.5rem; color: #fff; }
    </style>
</head>
<body>

<div class="container">
    <div class="panel">
        <h2>Loadout</h2>
        
        <h3>Player Base (Nothing On)</h3>
        <div class="stat-row"><span>Luck:</span> <span>803</span></div>
        <div class="stat-row"><span>Cap:</span> <span>25</span></div>
        <div class="stat-row"><span>Spd:</span> <span>0.45</span></div>

        <h3>Pans & Enchants</h3>
        <div class="input-group">
            <label>Select Pan</label>
            <select id="equip-pan" onchange="calculate()">
                <option value="none">None</option>
                <option value="blightflow">Blightflow Pan</option>
                <option value="gingerbread">Gingerbread Pan</option>
                <option value="abyssal">Abyssal Pan</option>
            </select>
        </div>
        <div class="input-group">
            <label>Enchant</label>
            <select id="pan-enchant" onchange="calculate()">
                <option value="none">None</option>
                <option value="glowing">Glowing (+25% Shake Spd)</option>
                <option value="cosmic">Cosmic (+50 Cap, +3 Shake Str)</option>
            </select>
        </div>

        <h3>Permanent Buffs</h3>
        <div class="ore-toggle">
            <input type="checkbox" id="mastery-luck" onchange="calculate()" checked>
            <label>Mastery Luck (0.25x)</label>
        </div>
        <div class="ore-toggle" style="margin-top:5px;">
            <input type="checkbox" id="runes-luck" onchange="calculate()" checked>
            <label>Runes Luck (1.2x)</label>
        </div>
        <div class="ore-toggle" style="margin-top:5px;">
            <input type="checkbox" id="runes-spd" onchange="calculate()" checked>
            <label>Runes Shake Spd (25%)</label>
        </div>
    </div>

    <div class="panel">
        <h2>Museum (All Voidtorn: Luck & Cap Boost)</h2>
        <div id="museum-container"></div>
    </div>

    <div class="panel">
        <h2>Final Stats</h2>
        <div class="stat-row"><span>Total Luck:</span> <span id="stat-luck">0</span></div>
        <div class="stat-row"><span>Total Capacity:</span> <span id="stat-cap">0</span></div>
        <div class="stat-row"><span>Total Shake Str:</span> <span id="stat-str">0</span></div>
        <div class="stat-row"><span>Total Shake Spd:</span> <span id="stat-spd">0</span></div>
        <div class="stat-row"><span>Breakpoint (r):</span> <span id="stat-r">0</span></div>

        <div class="big-result">
            <p style="margin:0; font-size:0.8rem; color:var(--accent);">REROLLS PER SECOND</p>
            <h1 id="result-rps">0.00</h1>
        </div>
        
        <div style="margin-top:20px; font-size:0.75rem; color:#666; line-height:1.4;">
            <strong>Formula used:</strong><br>
            $\frac{L \sqrt{C}}{\frac{C}{rs} + 2.5}$
        </div>
    </div>
</div>

<script>
    const speedTable = [
        { s: 250, r: 6.031 }, { s: 300, r: 6.906 }, { s: 350, r: 6.620 },
        { s: 400, r: 6.793 }, { s: 450, r: 9.119 }, { s: 500, r: 9.817 },
        { s: 550, r: 9.940 }, { s: 600, r: 10.461 }, { s: 650, r: 10.267 },
        { s: 710, r: 10.027 }, { s: 760, r: 9.119 }, { s: 810, r: 11.848 },
        { s: 860, r: 11.943 }, { s: 909, r: 12.325 }, { s: 939, r: 12.542 },
        { s: 989, r: 13.979 }, { s: 1039, r: 14.691 }, { s: 1069, r: 14.866 },
        { s: 1119, r: 13.953 }, { s: 1169, r: 11.592 }, { s: 1199, r: 14.299 },
        { s: 1249, r: 14.720 }, { s: 1299, r: 14.735 }, { s: 1329, r: 14.881 },
        { s: 1379, r: 14.451 }, { s: 1429, r: 12.658 }, { s: 1509, r: 11.981 },
        { s: 1559, r: 14.606 }, { s: 1689, r: 14.634 }, { s: 1731, r: 14.620 },
        { s: 1761, r: 12.853 }, { s: 1811, r: 15.259 }, { s: 1861, r: 15.385 },
        { s: 1941, r: 16.146 }, { s: 1991, r: 16.393 }, { s: 2121, r: 18.204 },
        { s: 2168, r: 14.313 }, { s: 2211, r: 19.231 }, { s: 2355, r: 19.608 }
    ];

    const pans = {
        blightflow: { luck: 500, cap: 400, str: 30, spd: 200 },
        gingerbread: { luck: 400, cap: 400, str: 25, spd: 120 },
        abyssal: { luck: 700, cap: 250, str: 8, spd: 110 }
    };

    const voidtorn = { "Common": 0.005, "Uncommon": 0.0075, "Rare": 0.0125, "Epic": 0.02, "Legendary": 0.03, "Mythic": 0.05, "Exotic": 0.08 };

    const museumData = {
        "Common": [{name: "Pyrite", buff: "cap", val: 0.05}, {name: "Seashell", buff: "cap", val: 0.05}, {name: "Pearl", buff: "spd", val: 0.05}, {name: "Silver", buff: "spd", val: 0.05}],
        "Uncommon": [{name: "Neodymium", buff: "str", val: 0.08}, {name: "Smoky Quartz", buff: "str", val: 0.08}, {name: "Topaz", buff: "cap", val: 0.08}],
        "Rare": [{name: "Peridot", buff: "luck", val: 0.13}, {name: "Ruby", buff: "str", val: 0.13}, {name: "Silver Clamshell", buff: "spd", val: 0.13}],
        "Epic": [{name: "Emerald", buff: "luck", val: 0.2}, {name: "Mercury", buff: "str", val: 0.2}, {name: "Moonstone", buff: "spd", val: 0.2}, {name: "Opal", buff: "spd", val: 0.2}],
        "Legendary": [{name: "Diamond", buff: "luck", val: 0.3}, {name: "Rose Gold", buff: "str", val: 0.3}, {name: "Starshine", buff: "spd", val: 0.15}, {name: "Specterite", buff: "spd", val: 0.3}],
        "Mythic": [{name: "Inferlume", buff: "luck", val: 0.5}, {name: "Pink Diamond", buff: "luck", val: 0.5}, {name: "Mythril", buff: "str", val: 0.5}, {name: "Prismara", buff: "luck_cap_str", val: 0.25}],
        "Exotic": [{name: "Vineheart", buff: "luck", val: 0.8}, {name: "Voidstone", buff: "luck_cap", val: 0.4}, {name: "North Star", buff: "luck_cap_spd", val: 0.2}, {name: "Eternium", buff: "luck_spd", val: 0.32}, {name: "Cryonic Artifact", buff: "str_spd", val: [1.2, -0.8]}]
    };

    function renderMuseum() {
        const container = document.getElementById('museum-container');
        for (const [rarity, ores] of Object.entries(museumData)) {
            const div = document.createElement('div');
            div.innerHTML = `<h3 style="color:var(--accent)">${rarity}</h3><div class="ore-grid" id="grid-${rarity}"></div>`;
            container.appendChild(div);
            const grid = document.getElementById(`grid-${rarity}`);
            ores.forEach(ore => {
                grid.innerHTML += `<label class="ore-toggle"><input type="checkbox" class="m-check" data-rarity="${rarity}" data-buff="${ore.buff}" data-val='${JSON.stringify(ore.val)}' onchange="calculate()">${ore.name}</label>`;
            });
        }
    }

    function calculate() {
        let L = 803, C = 25, S = 0.45, Str = 1;
        let mL = 0, mC = 0, mS = 0, mStr = 0;

        const panKey = document.getElementById('equip-pan').value;
        if(panKey !== 'none') {
            L += pans[panKey].luck; C += pans[panKey].cap; S += pans[panKey].spd; Str += pans[panKey].str;
        }

        const ench = document.getElementById('pan-enchant').value;
        if(ench === 'glowing') mS += 0.25;
        if(ench === 'cosmic') { C += 50; Str += 3; }

        if(document.getElementById('mastery-luck').checked) mL += 0.25;
        if(document.getElementById('runes-luck').checked) mL += 1.2;
        if(document.getElementById('runes-spd').checked) mS += 0.25;

        document.querySelectorAll('.m-check:checked').forEach(box => {
            const r = box.dataset.rarity;
            const b = box.dataset.buff;
            const v = JSON.parse(box.dataset.val);
            mL += voidtorn[r]; mC += voidtorn[r];

            if(b.includes('luck')) mL += Array.isArray(v) ? v[0] : v;
            if(b.includes('cap')) mC += Array.isArray(v) ? v[0] : v;
            if(b.includes('str')) mStr += Array.isArray(v) ? v[0] : v;
            if(b.includes('spd')) mS += Array.isArray(v) ? (v[1] || v[0]) : v;
        });

        const fL = L * (1 + mL);
        const fC = C * (1 + mC);
        const fS = S * (1 + mS);
        const fStr = Str * (1 + mStr);

        let r = 1;
        for(let entry of speedTable) { if(fS >= entry.s) r = entry.r; }

        const rps = (fL * Math.sqrt(fC)) / ((fC / (r * fStr)) + 2.5);

        document.getElementById('stat-luck').innerText = Math.floor(fL).toLocaleString();
        document.getElementById('stat-cap').innerText = Math.floor(fC).toLocaleString();
        document.getElementById('stat-str').innerText = fStr.toFixed(1);
        document.getElementById('stat-spd').innerText = fS.toFixed(1);
        document.getElementById('stat-r').innerText = r.toFixed(2);
        document.getElementById('result-rps').innerText = rps.toFixed(2);
    }

    renderMuseum();
    calculate();
</script>
</body>
</html>
