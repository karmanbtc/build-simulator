<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RNG Build Simlutor</title>
    <style>
        :root {
            --bg-color: #0d0d0d;
            --panel-bg: #161616;
            --accent: #00f2ff;
            --text-main: #e0e0e0;
            --border: #2a2a2a;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }

        .container {
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .panel {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        #museum-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            padding: 40px;
            overflow-y: auto;
        }

        .museum-content {
            background: var(--panel-bg);
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
            border: 2px solid var(--accent);
            border-radius: 15px;
        }

        .equipment-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .slot { background: #111; border: 1px solid #333; padding: 10px; border-radius: 8px; }
        .ring-slots-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
        
        h2 { color: var(--accent); margin-top: 0; font-size: 1.1rem; text-transform: uppercase; }
        h3 { font-size: 0.85rem; margin: 15px 0 8px; border-bottom: 1px solid #333; padding-bottom: 4px; }

        select, input {
            width: 100%; padding: 10px; background: #222; border: 1px solid #333;
            color: #fff; border-radius: 6px; font-size: 0.8rem;
        }

        .ore-toggle {
            display: flex; align-items: center; font-size: 0.7rem; background: #1e1e1e;
            padding: 6px; border-radius: 4px; cursor: pointer; margin-bottom: 4px;
        }

        .stat-card { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #222; font-size: 0.9rem; }
        .big-result {
            margin-top: 25px; padding: 25px; background: linear-gradient(145deg, #1a1a1a, #0a0a0a);
            border: 2px solid var(--accent); border-radius: 15px; text-align: center;
        }
        .big-result h1 { margin: 5px 0 0; font-size: 2.8rem; color: #fff; }

        .Common { color: #ccc; } .Uncommon { color: #1fd13a; } .Rare { color: #0059ff; }
        .Epic { color: #b11ae8; } .Legendary { color: #ffff00; } .Mythic { color: #cf0064; }
        .Exotic { color: #ff0011; }
    </style>
</head>
<body>

<div id="museum-overlay">
    <div class="museum-content">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <h2>Museum (Voidtorn Applied)</h2>
            <button onclick="toggleMuseum()" style="background:red; color:white; border:none; padding:5px 15px; cursor:pointer; border-radius:5px;">Close</button>
        </div>
        <div id="museum-container"></div>
    </div>
</div>

<div class="container">
    <div class="panel">
        <h2>Loadout & Passives</h2>
        <h3>Pans</h3>
        <select id="equip-pan" onchange="calculate()">
            <option value="none">No Pan</option>
            <option value="blightflow">Blightflow Pan</option>
            <option value="gingerbread">Gingerbread Pan</option>
            <option value="abyssal">Abyssal Pan</option>
        </select>
        <label style="font-size:0.75rem; color:#888; margin-top:5px; display:block;">Enchant</label>
        <select id="pan-enchant" onchange="calculate()">
            <option value="none">None</option>
            <option value="glowing">Glowing (+25% Spd)</option>
            <option value="cosmic">Cosmic (+50 Cap, +3 Str)</option>
        </select>

        <h3>Base Modifiers (Current)</h3>
        <label class="ore-toggle"><input type="checkbox" id="mastery-luck" onchange="calculate()" checked> Mastery Luck (0.25x)</label>
        <label class="ore-toggle"><input type="checkbox" id="runes-luck" onchange="calculate()" checked> Runes Luck (1.2x)</label>
        <label class="ore-toggle"><input type="checkbox" id="runes-spd" onchange="calculate()" checked> Runes Speed (25%)</label>

        <h3>Totems & MVP</h3>
        <label class="ore-toggle" style="border: 1px solid #ffd700; color:#ffd700;"><input type="checkbox" id="prospector-mvp" onchange="calculate()"> Prospector MVP (+.15x L/C)</label>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
            <label class="ore-toggle"><input type="checkbox" id="totem-luck" onchange="calculate()"> Luck Totem</label>
            <label class="ore-toggle"><input type="checkbox" id="totem-str" onchange="calculate()"> Str Totem</label>
            <label class="ore-toggle" style="grid-column: span 2;"><input type="checkbox" id="totem-lumi" onchange="calculate()"> Lumiant Totem (50% Spd)</label>
        </div>
        
        <button onclick="toggleMuseum()" style="width:100%; margin-top:10px; padding:10px; cursor:pointer; background:#222; border:1px solid var(--accent); color:var(--accent);">OPEN MUSEUM</button>
        <div style="margin-top:10px; font-size:0.65rem; color:#666;">Note: Stats 803 Luck / 0.45 Spd are treated as your Base. Unchecking passives reduces these.</div>
    </div>

    <div class="panel">
        <h2>Equipped Gear</h2>
        <div class="equipment-grid">
            <div class="slot">
                <label>Charm</label>
                <select id="slot-neck" onchange="calculate()">
                    <option value="none">Empty</option>
                    <option value="witch_hat">Witch Hat</option>
                    <option value="timelocked_soul">Timelocked Soul</option>
                </select>
            </div>
            <div class="slot">
                <label>Necklace</label>
                <select id="slot-charm" onchange="calculate()">
                    <option value="none">Empty</option>
                    <option value="venomshank">Venomshank</option>
                    <option value="santa_bag">Santa's Bag</option>
                </select>
            </div>
        </div>
        <h3>Rings (8 Slots)</h3>
        <div class="ring-slots-grid" id="ring-container"></div>
    </div>

    <div class="panel">
        <h2>Final Output</h2>
        <div class="stat-card"><span>Total Luck:</span> <span id="stat-luck">0</span></div>
        <div class="stat-card"><span>Total Capacity:</span> <span id="stat-cap">0</span></div>
        <div class="stat-card"><span>Shake Str:</span> <span id="stat-str">0</span></div>
        <div class="stat-card"><span>Shake Spd:</span> <span id="stat-spd">0</span></div>
        <div class="stat-card"><span>Speed Multi:</span> <span id="stat-spd-pct">100%</span></div>

        <div class="big-result">
            <div style="font-size:0.75rem; color:var(--accent);">REROLLS PER SECOND</div>
            <h1 id="result-rps">0.00</h1>
        </div>
    </div>
</div>

<script>
    const itemData = {
        rings: {
            purifying: { name: "Purifying", luck: 144, cap: 176, str: 48, spd: 0 },
            vortex: { name: "Vortex", luck: 248, cap: 520, str: 18, spd: 0 },
            otherworldly: { name: "Otherworldly", luck: 600, cap: 0, str: 0, spd: 0.35 },
            umbrite: { name: "Umbrite", luck: 392, cap: 160, str: 18, spd: 0 },
            champions: { name: "Champions", luck: 880, cap: 720, str: 88, spd: 160, unique: true }
        },
        charms: {
            venomshank: { luck: 2080, cap: 0 },
            santa_bag: { luck: 1080, cap: 880 }
        },
        neck: {
            witch_hat: { luck: 1760, spd: 44 },
            timelocked_soul: { luck: 1598, spd: 176 }
        }
    };

    const speedTable = [
        { s: 250, r: 6.031 }, { s: 500, r: 9.817 }, { s: 710, r: 10.027 }, 
        { s: 1039, r: 14.691 }, { s: 1559, r: 14.606 }, { s: 2121, r: 18.204 }, { s: 2355, r: 19.608 }
    ];

    const pans = {
        blightflow: { luck: 500, cap: 400, str: 30, spd: 200 },
        gingerbread: { luck: 400, cap: 400, str: 25, spd: 120 },
        abyssal: { luck: 700, cap: 250, str: 8, spd: 110 }
    };

    const museumData = {
        "Common": [ { name: "Pyrite", buff: "cap", val: 0.05 }, { name: "Seashell", buff: "cap", val: 0.05 }, { name: "Pearl", buff: "spd", val: 0.05 }, { name: "Silver", buff: "spd", val: 0.05 } ],
        "Uncommon": [ { name: "Coral", buff: "cap", val: 0.08 }, { name: "Topaz", buff: "cap", val: 0.08 }, { name: "Neodymium", buff: "str", val: 0.08 }, { name: "Smoky Quartz", buff: "str", val: 0.08 } ],
        "Rare": [ { name: "Peridot", buff: "luck", val: 0.13 }, { name: "Meteoric Iron", buff: "str", val: 0.13 }, { name: "Ruby", buff: "str", val: 0.13 }, { name: "Silver Clamshell", buff: "spd", val: 0.13 } ],
        "Epic": [ { name: "Emerald", buff: "luck", val: 0.20 }, { name: "Ammonite Fossil", buff: "cap", val: 0.20 }, { name: "Golden Pearl", buff: "cap", val: 0.20 }, { name: "Mercury", buff: "str", val: 0.20 }, { name: "Moonstone", buff: "spd", val: 0.20 }, { name: "Opal", buff: "spd", val: 0.20 } ],
        "Legendary": [ { name: "Diamond", buff: "luck", val: 0.30 }, { name: "Catseye", buff: "cap", val: 0.30 }, { name: "Firefly Stone", buff: "cap", val: 0.30 }, { name: "Luminum", buff: "cap", val: 0.30 }, { name: "Rose Gold", buff: "str", val: 0.30 }, { name: "Specterite", buff: "spd", val: 0.30 } ],
        "Mythic": [ { name: "Inferlume", buff: "luck", val: 0.50 }, { name: "Pink Diamond", buff: "luck", val: 0.50 }, { name: "Vortessence", buff: "cap", val: 0.50 }, { name: "Mythril", buff: "str", val: 0.50 } ],
        "Exotic": [ { name: "Vineheart", buff: "luck", val: 0.80 }, { name: "Voidstone", buff: "luck_cap", val: 0.40 }, { name: "North Star", buff: "luck_cap_spd", val: 0.20 }, { name: "Eternium", buff: "luck_spd", val: 0.32 } ]
    };

    function toggleMuseum() { const o = document.getElementById('museum-overlay'); o.style.display = o.style.display==='block'?'none':'block'; }

    function initRings() {
        const c = document.getElementById('ring-container');
        for(let i=1; i<=8; i++) {
            c.innerHTML += `<div class="slot"><select id="ring-${i}" onchange="validateRings(${i})"><option value="none">Empty</option>${Object.entries(itemData.rings).map(([k,v])=>`<option value="${k}">${v.name}</option>`).join('')}</select></div>`;
        }
    }

    function renderMuseum() {
        const container = document.getElementById('museum-container');
        for (const [rarity, ores] of Object.entries(museumData)) {
            const section = document.createElement('div');
            section.innerHTML = `<h3 class="${rarity}">${rarity}</h3><div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap:8px;" id="grid-${rarity}"></div>`;
            container.appendChild(section);
            const grid = document.getElementById(`grid-${rarity}`);
            ores.forEach(ore => {
                grid.innerHTML += `<label class="ore-toggle"><input type="checkbox" class="museum-box" data-buff="${ore.buff}" data-val='${JSON.stringify(ore.val)}' onchange="calculate()">${ore.name}</label>`;
            });
        }
    }

    function validateRings(idx) {
        const selects = Array.from({length:8}, (_,i)=>document.getElementById(`ring-${i+1}`));
        if(selects.filter(s=>s.value==='champions').length > 1) {
            alert("Only one Ring of Champions allowed!");
            document.getElementById(`ring-${idx}`).value = 'none';
        }
        calculate();
    }

    function calculate() {
        // 1. STAT BASES
        let L = 803, C = 25, S = 0, Str = 0;
        let multiL = 0, multiC = 0, multiS = 0, multiStr = 0;

        // 2. PASSIVE CORRECTION (Subtract if unchecked because they are in the base)
        if (!document.getElementById('mastery-luck').checked) multiL -= 0.25;
        if (!document.getElementById('runes-luck').checked) multiL -= 1.2;
        if (!document.getElementById('runes-spd').checked) multiS -= 0.25;

        // 3. TOTEMS & MVP
        if (document.getElementById('prospector-mvp').checked) { multiL += 0.15; multiC += 0.15; }
        if (document.getElementById('totem-luck').checked) multiL += 1.0;
        if (document.getElementById('totem-str').checked) multiStr += 1.0;
        if (document.getElementById('totem-lumi').checked) { multiC += 0.5; multiS += 0.5; }

        // 4. MUSEUM
        document.querySelectorAll('.museum-box:checked').forEach(box => {
            const b = box.dataset.buff;
            const v = JSON.parse(box.dataset.val);
            if(b === 'luck') multiL += v;
            if(b === 'cap') multiC += v;
            if(b === 'str') multiStr += v;
            if(b === 'spd') multiS += v;
            if(b === 'luck_cap') { multiL += v; multiC += v; }
            if(b === 'luck_cap_spd') { multiL += v; multiC += v; multiS += v; }
            if(b === 'luck_spd') { multiL += v; multiS += v; }
        });

        // 5. EQUIPMENT
        const pan = pans[document.getElementById('equip-pan').value];
if (pan) { L += pan.luck; C += pan.cap; multiS += (pan.spd / 100 || 0); Str += pan.str; }
        const enc = document.getElementById('pan-enchant').value;
        if (enc === 'glowing') multiS += 0.25;
        if (enc === 'cosmic') { C += 50; Str += 3; }

        const neck = itemData.neck[document.getElementById('slot-neck').value];
        if (neck) { L += neck.luck; S += neck.spd; }
        const charm = itemData.charms[document.getElementById('slot-charm').value];
        if (charm) { L += charm.luck; C += charm.cap; }

        for(let i=1; i<=8; i++) {
            const rKey = document.getElementById(`ring-${i}`).value;
            const r = itemData.rings[rKey];
            if (r) { 
                L += r.luck; C += r.cap; Str += r.str;
                if (rKey === 'otherworldly') multiS += r.spd; else S += r.spd;
            }
        }

        // 6. FINAL TOTALS
        const totalL = L * (1 + multiL);
        const totalC = C * (1 + multiC);
        const totalStr = Str * (1 + multiStr);
        const totalS = S * (1 + multiS);

        let rVal = 1;
        for (let entry of speedTable) { if (totalS >= entry.s) rVal = entry.r; }
        const rps = (totalL * Math.sqrt(totalC)) / ((totalC / (rVal * totalStr)) + 2.5);

        document.getElementById('stat-luck').innerText = Math.floor(totalL).toLocaleString();
        document.getElementById('stat-cap').innerText = Math.floor(totalC).toLocaleString();
        document.getElementById('stat-str').innerText = totalStr.toFixed(1);
        document.getElementById('stat-spd').innerText = totalS.toFixed(2);
        document.getElementById('stat-spd-pct').innerText = Math.round((1 + multiS) * 100) + "%";
        document.getElementById('result-rps').innerText = rps.toFixed(2);
    }

    initRings();
    renderMuseum();
    calculate();
</script>
</body>
</html>
